# Operation Neusploit (APT28) / CVE-2026-21509 - LogScale Queries
These queries are untested in your environment and are provided as guidance/examples. Validate and tune before operational use.

Queries align to the hunt playbook and IOC JSON.


## DNS to staging domains (high confidence)
```logscale
in(field=#event_simpleName, values=["DnsRequest","SuspiciousDnsRequest"])
| in(field=DomainName, values=["freefoodaid.com","wellnessmedcare.org","wellnesscaremed.com"])
| groupBy([DomainName,#repo], function=([count(aid, as=EventsCount, distinct=true), min(ContextTimeStamp, as=FirstEvent), max(ContextTimeStamp, as=LastEvent), collect([ComputerName,aid,ContextBaseFileName,ContextProcessId,QueryStatus], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## Network connects to known staging IPs (if NetworkConnect telemetry is available)
```logscale
#event_simpleName=NetworkConnectIP4
| in(field=RemoteAddressIP4, values=["193.187.148.169","159.253.120.2"])
| case {
  RemoteAddressIP4=* | RemoteIP:=RemoteAddressIP4;
}
| groupBy([RemoteIP,#repo], function=([count(aid, as=EventsCount, distinct=true), min(ContextTimeStamp, as=FirstEvent), max(ContextTimeStamp, as=LastEvent), collect([ComputerName,aid,LocalAddressIP4,LocalAddressIP6,RemotePort,ContextBaseFileName], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## WebDAV LNK access patterns (file://.../davwwwroot/...lnk?init=1)
```logscale
in(field=#event_simpleName, values=["FileOpenInfo","FileWritten","LnkFileWritten","FileDetectInfo","ProcessRollup2","SyntheticProcessRollup2"])
| regex(field=TargetFileName, regex="file://[^\\s]+/davwwwroot/.+\\.lnk\\?init=1", flags="Fi") or regex(field=@rawstring, regex="file://[^\\s]+/davwwwroot/.+\\.lnk\\?init=1", flags="Fi")
| case {
  ContextTimeStamp=* | EventTime:=ContextTimeStamp;
  timestamp=* | EventTime:=timestamp;
}
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(EventTime, as=FirstEvent), max(EventTime, as=LastEvent), collect([#event_simpleName,ContextBaseFileName,CommandLine,TargetFileName,FileName,@rawstring], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## WebDAV client usage (davclnt.dll / WebClient)
```logscale
#event_simpleName=ProcessRollup2 event_platform=Win
| (ImageFileName=/\\rundll32\.exe$/i and CommandLine=/davclnt\.dll/i) or (ImageFileName=/\\svchost\.exe$/i and CommandLine=/WebClient/i)
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(ProcessStartTime, as=FirstEvent), max(ProcessStartTime, as=LastEvent), collect([ImageFileName,CommandLine,ParentImageFileName,ParentCommandLine], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## Office processes opening RTF/DOC from user temp or Outlook cache
```logscale
#event_simpleName=ProcessRollup2 event_platform=Win
| ImageFileName=/\\(winword|excel|powerpnt)\.exe$/i
| regex(field=CommandLine, regex="\\.(rtf|doc|docx)\"?", flags="Fi")
| regex(field=CommandLine, regex="(Content\.Outlook|INetCache|Temp|AppData\\Local\\Temp)", flags="Fi")
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(ProcessStartTime, as=FirstEvent), max(ProcessStartTime, as=LastEvent), collect([ImageFileName,CommandLine,ParentImageFileName], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## Payload file writes (MiniDoor + PixyNetLoader artifacts)
```logscale
in(field=#event_simpleName, values=["FileWritten","PeFileWritten","FileDetectInfo","RtfFileWritten","OoxmlFileWritten","OleFileWritten","LnkFileWritten","PngFileWritten","PdfFileWritten"])
| in(field=FileName, values=["2_2.d","tables.d","office.xml","VbaProject.OTM","EhStoreShell.dll","SplashScreen.png"])
| groupBy([ComputerName,aid,#repo,FileName], function=([count(aid, as=EventsCount), min(ContextTimeStamp, as=FirstEvent), max(ContextTimeStamp, as=LastEvent), collect([TargetFileName,FilePath,SHA256HashData,ContextBaseFileName,ContextProcessId], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## Known file hashes (RTF lures, droppers, payloads)
```logscale
in(field=#event_simpleName, values=["FileWritten","PeFileWritten","FileDetectInfo","RtfFileWritten","OoxmlFileWritten","OleFileWritten","LnkFileWritten","PngFileWritten","ProcessRollup2","SyntheticProcessRollup2"])
| in(field=SHA256HashData, values=[
"b2ba51b4491da8604ff9410d6e004971e3cd9a321390d0258e294ac42010b546",
"1ed863a32372160b3a25549aad25d48d5352d9b4f58d4339408c4eea69807f50",
"5a17cfaea0cc3a82242fdd11b53140c0b56256d769b07c33757d61e0a0a6ec02",
"fd3f13db41cd5b442fa26ba8bc0e9703ed243b3516374e3ef89be71cbf07436b",
"c91183175ce77360006f964841eb4048cf37cb82103f2573e262927be4c7607f",
"a944a09783023a2c6c62d3601cbd5392a03d808a6a51728e07a3270861c2a8ee",
"bb23545380fde9f48ad070f88fe0afd695da5fcae8c5274814858c5a681d8c4e",
"0bb0d54033767f081cae775e3cf9ede7ae6bea75f35fbfb748ccba9325e28e5e",
"a876f648991711e44a8dcf888a271880c6c930e5138f284cd6ca6128eca56ba1",
"2822c72a59b58c00fc088aa551cdeeb92ca10fd23e23745610ff207f53118db9",
"9f4672c1374034ac4556264f0d4bf96ee242c0b5a9edaa4715b5e61fe8d55cc8",
"3f446d316efe2514efd70c975d0c87e12357db9fca54a25834d60b28192c6a69"
])
| case {
  ContextTimeStamp=* | EventTime:=ContextTimeStamp;
  timestamp=* | EventTime:=timestamp;
}
| groupBy([ComputerName,aid,#repo,SHA256HashData], function=([count(aid, as=EventsCount), min(EventTime, as=FirstEvent), max(EventTime, as=LastEvent), collect([#event_simpleName,FileName,TargetFileName,FilePath,ImageFileName,CommandLine], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## MiniDoor: Outlook VBA persistence file creation
```logscale
in(field=#event_simpleName, values=["FileWritten","PeFileWritten","FileDetectInfo","OoxmlFileWritten"])
| FileName="VbaProject.OTM"
| regex(field=TargetFileName, regex="\\\\Users\\\\[^\\\\]+\\\\AppData\\\\Roaming\\\\Microsoft\\\\Outlook\\\\VbaProject\\.OTM$", flags="Fi") or regex(field=FilePath, regex="\\\\Users\\\\[^\\\\]+\\\\AppData\\\\Roaming\\\\Microsoft\\\\Outlook\\\\VbaProject\\.OTM$", flags="Fi")
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(ContextTimeStamp, as=FirstEvent), max(ContextTimeStamp, as=LastEvent), collect([TargetFileName,FilePath,SHA256HashData,ContextBaseFileName,ContextProcessId], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## MiniDoor: Outlook macro security downgrades
```logscale
in(field="#event_simpleName", values=["AsepValueUpdate","SuspiciousRegAsepUpdate","RegGenericValueUpdate","RegSystemConfigValueUpdate"]) event_platform=Win
| regex(field=RegObjectName, regex="\\\\Software\\\\Microsoft\\\\Office\\\\16\\.0\\\\Outlook\\\\(Security|Options\\\\General)$", flags="Fi")
| in(field=RegValueName, values=["Level","LoadMacroProviderOnBoot","PONT_STRING"])
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(timestamp, as=FirstEvent), max(timestamp, as=LastEvent), collect([RegObjectName,RegValueName,RegStringValue,RegValueType,RegOperationType,ContextProcessId,TargetCommandLineParameters], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## PixyNetLoader: COM hijack CLSID set to EhStoreShell.dll
```logscale
in(field="#event_simpleName", values=["AsepValueUpdate","SuspiciousRegAsepUpdate","RegGenericValueUpdate","RegSystemConfigValueUpdate"]) event_platform=Win
| regex(field=RegObjectName, regex="\\\\Software\\\\Classes\\\\CLSID\\\\\\{D9144DCD-E998-4ECA-AB6A-DCD83CCBA16D\\\\}\\\\InProcServer32$", flags="Fi")
| regex(field=RegStringValue, regex="EhStoreShell\\.dll", flags="Fi")
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(timestamp, as=FirstEvent), max(timestamp, as=LastEvent), collect([RegObjectName,RegValueName,RegStringValue,RegValueType,RegOperationType,ContextProcessId,TargetCommandLineParameters], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## PixyNetLoader: scheduled task OneDriveHealth (task registration or schtasks.exe)
```logscale
in(field=#event_simpleName, values=["ScheduledTaskRegistered","ScheduledTaskModified","ScheduledTaskDeleted","ProcessRollup2","SyntheticProcessRollup2"])
| (TaskName=/OneDriveHealth/i) or (ImageFileName=/\\\\schtasks\\.exe$/i and CommandLine=/\\/TN\\s+OneDriveHealth/i)
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(timestamp, as=FirstEvent), max(timestamp, as=LastEvent), collect([TaskName,TaskPath,ImageFileName,CommandLine,ParentImageFileName], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## PixyNetLoader: EhStoreShell.dll and SplashScreen.png in expected paths
```logscale
in(field=#event_simpleName, values=["FileWritten","PeFileWritten","FileDetectInfo","PngFileWritten"])
| (FileName="EhStoreShell.dll" and (regex(field=TargetFileName, regex="\\\\ProgramData\\\\USOPublic\\\\Data\\\\User\\\\EhStoreShell\\.dll$", flags="Fi") or regex(field=FilePath, regex="\\\\ProgramData\\\\USOPublic\\\\Data\\\\User\\\\EhStoreShell\\.dll$", flags="Fi")))
  or (FileName="SplashScreen.png" and (regex(field=TargetFileName, regex="\\\\ProgramData\\\\Microsoft OneDrive\\\\setup\\\\Cache\\\\SplashScreen\\.png$", flags="Fi") or regex(field=FilePath, regex="\\\\ProgramData\\\\Microsoft OneDrive\\\\setup\\\\Cache\\\\SplashScreen\\.png$", flags="Fi")))
| groupBy([ComputerName,aid,#repo,FileName], function=([count(aid, as=EventsCount), min(ContextTimeStamp, as=FirstEvent), max(ContextTimeStamp, as=LastEvent), collect([TargetFileName,FilePath,SHA256HashData,ContextBaseFileName,ContextProcessId], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## office.xml staging in Temp\Diagnostics
```logscale
in(field=#event_simpleName, values=["FileWritten","PeFileWritten","FileDetectInfo"])
| FileName="office.xml"
| regex(field=TargetFileName, regex="\\\\Temp\\\\Diagnostics\\\\office\\.xml$", flags="Fi") or regex(field=FilePath, regex="\\\\Temp\\\\Diagnostics\\\\office\\.xml$", flags="Fi")
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(ContextTimeStamp, as=FirstEvent), max(ContextTimeStamp, as=LastEvent), collect([TargetFileName,FilePath,SHA256HashData,ContextBaseFileName,ContextProcessId], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```

## RTF/DOC lure file writes by Office (broader net)
```logscale
in(field=#event_simpleName, values=["FileWritten","FileDetectInfo","RtfFileWritten","OoxmlFileWritten","OleFileWritten"])
| regex(field=FileName, regex="\\.(rtf|doc|docx)$", flags="Fi")
| regex(field=ContextBaseFileName, regex="\\\\(winword|excel|powerpnt)\\.exe$", flags="Fi")
| groupBy([ComputerName,aid,#repo], function=([count(aid, as=EventsCount), min(ContextTimeStamp, as=FirstEvent), max(ContextTimeStamp, as=LastEvent), collect([FileName,TargetFileName,FilePath,SHA256HashData,ContextBaseFileName], limit=20000)]))
| FirstEvent:=formatTime(format="%F %T.%L", field="FirstEvent")
| LastEvent:=formatTime(format="%F %T.%L", field="LastEvent")
```
