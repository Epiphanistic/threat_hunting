# SharePoint ToolShell CVE-2025-53770 and CVE-2025-53771 Exploitation

## Executive summary
The ToolShell chain includes CVE-2025-53770 (deserialization leading to
unauthenticated RCE) and CVE-2025-53771 (path traversal enabling spoofing
and abuse of SharePoint paths). These on-prem SharePoint vulnerabilities
have been actively exploited to drop ASPX web shells, extract MachineKey
secrets, and deliver follow-on payloads including ransomware. This hunt
focuses on identifying vulnerable servers, spotting exploit activity
against /_layouts/15/ToolPane.aspx, detecting web shell drops
(spinstall0.aspx), and correlating detections on known-targeted
SharePoint hosts.

## Risk if true
- Unauthenticated RCE on SharePoint servers.
- MachineKey extraction enabling forged ViewState and persistent access.
- Web shell persistence (ASPX) and .NET module execution in memory.
- Lateral movement and data theft from connected Microsoft services.
- Ransomware deployment via post-exploitation payloads.

## Hypothesis
If ToolShell exploitation occurred, SharePoint servers will show web
requests to ToolPane.aspx in Edit mode (often with SignOut.aspx referrer),
followed by spinstall0.aspx access or other ASPX writes under SharePoint
layouts. The CVE-2025-53770 deserialization RCE path enables upload and
execution of web shells or in-memory .NET modules via w3wp.exe, while
CVE-2025-53771 path traversal can aid spoofing and file placement.
Compromised hosts will show MachineKey extraction artifacts, ViewState
forgery attempts, and outbound traffic to attacker infrastructure. Known
exploitation-source IPs will appear in network telemetry, and EDR
detections will correlate on vulnerable hosts.

## Scope
- In-scope: on-prem SharePoint 2016/2019/SE servers and related IIS logs.
- Time window: 30 days for exploit activity; extend to 90 days as needed.
- Out-of-scope: SharePoint Online (not impacted).

## MITRE mapping
- T1190 - Exploit Public-Facing Application (Initial Access): IP IoC hits
  plus ToolPane.aspx access patterns in IIS/WAF logs.
- T1505.003 - Server Software Component: Web Shell (Persistence): ASPX
  file writes (spinstall0.aspx/toolpane.aspx) and access to web shells.
- T1552.004 - Unsecured Credentials: Private Keys (Credential Access):
  MachineKey extraction indicators and spinstall0.aspx activity.
- T1059.001 - Command and Scripting Interpreter: PowerShell (Execution):
  correlated detections on SharePoint hosts and suspicious script exec.
- T1041 - Exfiltration Over C2 Channel (Exfiltration): outbound network
  connections to known C2 IPs/domains in the IoC hits.

## Data sources
- IIS logs and reverse proxy/WAF logs for SharePoint.
- EDR process, script, and file-write telemetry on SharePoint servers.
- DNS/Netflow for suspicious outbound connections.
- Windows event logs for web server and scheduled task activity.

## Expected outcome
- Inventory of vulnerable/targeted SharePoint hosts.
- Evidence of web shell drops (spinstall0.aspx) or suspicious ASPX writes.
- Correlated detections tied to w3wp.exe and in-memory .NET activity.
- Remediation list for patching, key rotation, and incident response.

## LogScale queries
Moved to: [SharePoint ToolShell LogScale queries](SharePoint_ToolShell_Logscale_queries.md)

## Indicators of compromise
### Exploitation source IPs
- 34.72.225.196
- 34.121.207.116
- 45.77.155.170
- 45.86.231.241
- 45.191.66.77
- 51.161.152.26
- 64.176.50.109
- 86.48.9.38
- 89.46.223.88
- 91.132.95.60
- 91.236.230.76
- 92.222.167.88
- 95.179.158.42
- 96.9.125.147
- 103.186.30.186
- 104.238.159.149
- 107.191.58.76
- 128.199.240.182
- 131.226.2.6
- 134.199.202.205
- 139.144.199.41
- 141.164.60.10
- 145.239.97.206
- 149.28.124.70
- 149.40.50.15
- 154.223.19.106
- 185.197.248.131
- 188.130.206.168
- 206.166.251.228
- 212.125.27.102

### Web shell and file paths
- spinstall0.aspx (known web shell)
- toolpane.aspx (known bad filename)
- C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\16\TEMPLATE\LAYOUTS\spinstall0.aspx
- C:\PROGRA~1\COMMON~1\MICROS~1\WEBSER~1\16\TEMPLATE\LAYOUTS\spinstall0.aspx
- C:\PROGRA~1\COMMON~1\MICROS~1\WEBSER~1\15\TEMPLATE\LAYOUTS\spinstall0.aspx
- C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\16\TEMPLATE\LAYOUTS\debug_dev.js

### Web request indicators
- GET /_layouts/15/ToolPane.aspx?DisplayMode=Edit&a=/ToolPane.aspx
- POST /_layouts/15/ToolPane.aspx?DisplayMode=Edit&a=/ToolPane.aspx
- GET /_layouts/15/spinstall0.aspx
- Referrer: /_layouts/SignOut.aspx
- User-Agent: python-requests/2.32.3

### File hashes (SHA256)
- 92bb4ddb98eeaf11fc15bb32e71d0a63256a0ed826a03ba293ce3a8bf057a514 (spinstall0.aspx)
- 8d3d3f3a17d233bc8562765e61f7314ca7a08130ac0fb153ffd091612920b0f2 (spinstall0.aspx)
- 27c45b8ed7b8a7e5fff473b50c24028bd028a9fe8e25e5cea2bf5e676e531014 (spinstall0.aspx)
- b336f936be13b3d01a8544ea3906193608022b40c28dd8f1f281e361c9b64e93 (test.txt)
- 4a02a72aedc3356d8cb38f01f0e0b9f26ddc5ccb7c0f04a561337cf24aa84030 (.NET module qlj22mpc)
- b39c14becb62aeb55df7fd55c814afbb0d659687d947d917512fe67973100b70 (.NET module bjcloiyq)
- fa3a74a6c015c801f5341c02be2cbdfb301c6ed60633d49fc0bc723617741af7 (.NET module targeting ViewState)
- 390665bdd93a656f48c463bb6c11a4d45b7d5444bdd1d1f7a5879b0f6f9aac7e (.NET module)
- 66af332ce5f93ce21d2fe408dffd49d4ae31e364d6802fff97d95ed593ff3082 (.NET module)
- 7baf220eb89f2a216fcb2d0e9aa021b2a10324f0641caf8b7a9088e4e45bec95 (.NET module)
- 33067028e35982c7b9fdcfe25eb4029463542451fdff454007832cf953feaf1e (4L4MD4R ransomware)

### Ransomware infrastructure
- hxxps://ice.theinnovationfactory[.]it/static/4l4md4r.exe
- bpp.theinnovationfactory[.]it

## Triage and response tips
- Verify SharePoint patch level and KBs installed on targeted servers.
- Inspect IIS logs for ToolPane.aspx and spinstall0.aspx access patterns.
- Look for ASPX writes under SharePoint LAYOUTS directories.
- Check w3wp.exe for in-memory .NET execution and suspicious call stacks.
- Rotate MachineKeys and invalidate ViewState if compromise is suspected.

## Validation
- Confirm web shell presence and hash values on disk.
- Validate IP hits against SharePoint server logs and EDR telemetry.
- Review outbound connections from SharePoint servers to suspicious IPs.
- Correlate detection summaries with web shell creation timestamps.

## Containment
- Apply Microsoft patches and mitigations immediately.
- Remove web shells and malicious ASPX files.
- Rotate MachineKey and other cryptographic secrets.
- Isolate compromised servers and engage incident response.

## Deliverables
- Host list with evidence of exploitation or web shell presence.
- IOC hit report (IP, path, hash, and URL matches).
- Remediation tracking for patching and key rotation.
- Executive summary of exposure and confirmed compromise scope.

## Exit criteria
- No web shell artifacts or suspicious ASPX writes on SharePoint servers.
- All vulnerable servers patched and keys rotated.
- No IOC hits in logs for the monitoring window.

## References
https://unit42.paloaltonetworks.com/microsoft-sharepoint-cve-2025-49704-cve-2025-49706-cve-2025-53770/
https://www.trendmicro.com/en_us/research/25/g/cve-2025-53770-and-cve-2025-53771-sharepoint-attacks.html
